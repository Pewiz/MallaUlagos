---
import Layout from "../../layouts/Layout.astro";
import type { GetStaticPaths } from "astro";

// Definir el tipo Carrera
interface Carrera {
  id: number;
  slug: string;
  nombre: string;
  descripcion: string;
}

// Obtener los slugs de todas las carreras en build time
export const getStaticPaths: GetStaticPaths = async () => {
  const response = await fetch("http://127.0.0.1:8000/api/carreras/carreras");
  const carreras: Carrera[] = await response.json();

  return carreras.map((carrera) => ({
    params: { slug: carrera.slug },
    props: { carrera }, // Pasamos la carrera como prop
  }));
};

// Tipamos Astro.props para evitar el error
const { carrera } = Astro.props as { carrera: Carrera };

// Obtener la malla curricular de la carrera
const mallaResponse = await fetch(
  `http://127.0.0.1:8000/api/carreras/carreras/${carrera.id}`
);
const malla = await mallaResponse.json();
---

<Layout title={`Malla - ${carrera.nombre}`}>
  <h1 class="text-3xl font-bold">{carrera.nombre}</h1>
  <p>{carrera.descripcion}</p>

  <h2 class="text-2xl mt-4">Malla Curricular</h2>
  <ul>
    {malla.ramos.map((ramo) => <li key={ramo.id}>{ramo.nombre}</li>)}
  </ul>

  <a href="/">Volver al inicio</a>
</Layout>
